"use strict";var albumBucketName="photos.sowrey.org",s3Endpoint="photos.sowrey.org.s3.ca-central-1.amazonaws.com";AWS.config.region="us-east-2",AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:"us-east-2:0806a01f-c913-4f3c-babb-f9cb6af8cdcf"});var s3=new AWS.S3({apiVersion:"2006-03-01",params:{Bucket:albumBucketName}});async function getEXIF(e){var t;try{delete(t=await ExifReader.load(e)).MakerNote}catch(a){console.log("Unable to read EXIF")}showMeta(t)}function getHtml(e){return e.join("\n")}function correctARN(){s3.endpoint.host=s3.endpoint.hostname=s3.config.endpoint=s3Endpoint,s3.config.s3BucketEndpoint=!0}function toFraction(e,t){if(0==e)return 0;e<0&&(e=-e),t||(t=1e-4);var a=1,n=1;return!function r(){var i=a/n;Math.abs((i-e)/e)<t||(i<e?a++:n++,r())}(),a+"/"+n}function updatePage(){correctARN();var e=window.location.pathname.split("/"),t='<li><a href="/">All Albums</a></li>',a="listAlbums",n="";if(e[1]&&""!==e[1]||e[2]&&""!==e[2]){var r=decodeURI(e[1]).replace(" ","+");t+='<li><a href="/'+r+'/">'+e[1].replace(/\+/g," ")+"</a></li>",a="viewAlbum",n=e[1]}if(e[2]&&""!==e[2]){var r=decodeURI(e[1]).replace(" ","+");t+='<li><a href="/'+r+"/"+e[2]+'">'+e[2]+"</a></li>",a="showImage",n=e[1]+"/"+e[2]}var i=document.querySelectorAll("nav ul");void 0!==i&&i[0]&&(i[0].innerHTML=t),grover(),window[a](n)}function grover(){document.querySelector("#grover").addEventListener("mouseover",e=>{var t="";switch(e.target.textContent){case"Near":t="map16";break;case"(Pant,pant)":t="map10";break;case"Far!":t="map6"}if(""!==t){for(var a=document.getElementById("photogeo").getElementsByTagName("img"),n=0;n<a.length;n++)a[n].style.display="none";document.getElementById(t).style.display="block"}})}function listAlbums(){s3.listObjects({Delimiter:"/"},function(e,t){if(e)var a=getHtml(["<p>","There was an error listing your albums: "+e.message,"</p>"]);else var n=t.CommonPrefixes.map(function(e){var t=e.Prefix.replace("/",""),a=t.split(" "),n="thumb_"+t.replace(/\s/g,"_");return getHtml(["<li>",'<a href="/'+a.join("+")+'/">','<img src="//'+s3Endpoint+"/"+n+'.jpg" height="250" width="250" />',"<br />"+t,"</a>","</li>"])}),a=[n.length?getHtml([]):"<p>Hmm. No albums found. That's ... odd.</p>","<ul>",getHtml(n),"</ul>",];document.getElementById("albumlist").innerHTML=getHtml(a),document.getElementById("albums").style.display="block"})}function viewAlbum(e){var t=(e=e.replace(/\+/g," "))+"/";s3.listObjects({Prefix:t},function(t,a){if(t)return alert("There was an error viewing your album: "+t.message);var n="//"+s3.endpoint.host+"/",r=document.querySelector("#contents h2 span");void 0!==r&&(r.innerHTML=e);var i=a.Contents.map(function(e){var t=e.Key.split("/"),a=e.Key.replace(/\s/g,"+");return t[0]=t[0].replace(/\s/g,"+"),getHtml(["<li>",'<a href="/'+a+'">','<img src="'+(n+t[0]+"/")+t[1]+'" height="350" />',"</a>","</li>"])}),o=[i.length?"":"<p>There are no photos in this album.</p>","<ul>",getHtml(i),"</ul>"];document.getElementById("pictures").innerHTML=getHtml(o),document.getElementById("contents").style.display="block"})}function showImage(e){var t=document.getElementById("hero"),a="//"+s3.config.endpoint+"/"+e,n=window.location.origin;fetch(a,{method:"get",mode:"cors",headers:new Headers({Origin:n})}).then(function(e){t.src=e.url,getEXIF(t.src)}).catch(function(e){t.style.display="none";var a=document.querySelector("#details > div");a.style.height="auto",a.style.backgroundColor="#fff",document.querySelector("#details div p").textContent=e}),document.getElementById("details").style.display="block"}function showMeta(e){var t,a=!1;for(let n in e){var r=document.getElementById(n),i=e[n].description;switch(n){case"DateTimeOriginal":let o=["January","February","March","April","May","June","July","August","September","October","November","December"];var l=i.split(" ")[0].split(":");i=""+parseInt(l[2])+" "+o[parseInt(l[1])-1]+" "+l[0];break;case"title":t=!0;break;case"description":a=!0}null!==r&&(r.innerHTML=i)}if(e.GPSLatitude&&e.GPSLongitude){var s="N"===e.GPSLatitudeRef.value[0]?"":"-",c=("E"===e.GPSLongitudeRef.value[0]?"":"-")+e.GPSLongitude.description,u="https://maps.geoapify.com/v1/staticmap?style=osm-carto&width=300&height=200&center=lonlat:"+(c+=","+s+e.GPSLatitude.description)+"&marker=lonlat:"+c+";color:%23ff0000;size:medium&apiKey=567f0d30482f4ad8b8674c54af6613f5";document.getElementById("map6").src=u+"&zoom=4",document.getElementById("map10").src=u+"&zoom=10",document.getElementById("map16").src=u+"&zoom=16"}t||(document.querySelector("#details h2").innerHTML="Untitled"),a||(document.querySelector("#details p").style.display="none")}window.onload=updatePage;