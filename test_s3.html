<!DOCTYPE html>
<!-- AWS IAM Pool Name: Photo Display -->
<!-- AWS IAM Unauth Role Name: Cognito_PhotoDisplayUnauth_Role -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>EXIF example with inline EXIF info</title>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1353.0.min.js"></script>
</head>
<body>

    <div id="viewer">
    </div>

    <script>
        var albumBucketName = 'photos.sowrey.org';
        // Initialize the Amazon Cognito credentials provider
        AWS.config.region = 'us-east-2'; // Region
        AWS.config.credentials = new AWS.CognitoIdentityCredentials({
            IdentityPoolId: 'us-east-2:0806a01f-c913-4f3c-babb-f9cb6af8cdcf',
        });

        // Create a new service object
        var s3 = new AWS.S3({
            apiVersion: '2006-03-01',
            params: {Bucket: albumBucketName}
        });

        // A utility function to create HTML.
        function getHtml(template) {
            return template.join('\n');
        }

        // List the photo albums that exist in the bucket.
        function listAlbums() {
            s3.listObjects({Delimiter: '/'}, function(err, data) {
                if (err) {
                    return alert('There was an error listing your albums: ' + err.message);
                } else {
                    var albums = data.CommonPrefixes.map(function(commonPrefix) {
                        var prefix = commonPrefix.Prefix;
                        var albumName = decodeURIComponent(prefix.replace('/', ''));
                        return getHtml([
                        '<li>',
                            '<button style="margin:5px;" onclick="viewAlbum(\'' + albumName + '\')">',
                            albumName,
                            '</button>',
                        '</li>'
                        ]);
                    });
                    var message = albums.length ?
                        getHtml([
                        '<p>Click on an album name to view it.</p>',
                        ]) :
                        '<p>You do not have any albums. Please Create album.';
                    var htmlTemplate = [
                        '<h2>Albums</h2>',
                        message,
                        '<ul>',
                        getHtml(albums),
                        '</ul>',
                    ]
                    document.getElementById('viewer').innerHTML = getHtml(htmlTemplate);
                }
            });
        }
        window.onload=listAlbums;
    </script>
</body>
</html>